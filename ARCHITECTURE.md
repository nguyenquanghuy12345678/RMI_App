# KIáº¾N TRÃšC Há»† THá»NG - RMI Banking

## ğŸ“ SÆ¡ Ä‘á»“ tá»•ng quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT LAYER                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Client UI 1  â”‚  â”‚   Client UI 2  â”‚  â”‚   Client UI N  â”‚        â”‚
â”‚  â”‚   (Swing)      â”‚  â”‚   (Swing)      â”‚  â”‚   (Swing)      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                   â”‚                   â”‚
            â”‚    RMI Protocol (Port 1099)          â”‚
            â”‚                   â”‚                   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APPLICATION LAYER                               â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                          â”‚  RMI Server  â”‚                          â”‚
â”‚                          â”‚  (Java RMI)  â”‚                          â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                â”‚                                   â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                          â”‚ Business   â”‚                           â”‚
â”‚                          â”‚ Logic      â”‚                           â”‚
â”‚                          â”‚ Layer      â”‚                           â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                â”‚                                   â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                          â”‚ Database   â”‚                           â”‚
â”‚                          â”‚ Handler    â”‚                           â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                       â”‚
         JDBC Connection          JDBC Connection
                    â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        DATABASE LAYER 1   â”‚    â”‚    DATABASE LAYER 2             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   MySQL Server 1    â”‚  â”‚    â”‚  â”‚   MySQL Server 2    â”‚       â”‚
â”‚  â”‚   (192.168.1.100)   â”‚  â”‚    â”‚  â”‚   (192.168.1.101)   â”‚       â”‚
â”‚  â”‚   Port: 3306        â”‚  â”‚    â”‚  â”‚   Port: 3306        â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚   Database: bank_db â”‚  â”‚    â”‚  â”‚   Database: bank_db â”‚       â”‚
â”‚  â”‚   Table: accounts   â”‚  â”‚    â”‚  â”‚   Table: accounts   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–²                                    â–²
           â”‚        SYNCHRONIZED DATA           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Luá»“ng xá»­ lÃ½ Chuyá»ƒn khoáº£n

```
Client UI                RMI Server              DB Handler           MySQL 1 & 2
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚â”€â”€1. transfer()â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                      â”‚
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚                        â”‚â”€â”€2. transfer()â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚                        â”‚                       â”‚â”€â”€3. BEGIN TRANSâ”€â”€â”€â”€â”€>â”‚
    â”‚                        â”‚                       â”‚   (Cáº£ 2 DB)          â”‚
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚                        â”‚                       â”‚â”€â”€4. Check balanceâ”€â”€â”€>â”‚
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚                        â”‚                       â”‚<â”€5. Return balanceâ”€â”€â”€â”‚
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚                        â”‚                       â”‚â”€â”€6. Update DB1â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                        â”‚                       â”‚   (Trá»« tiá»n Account A)â”‚
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚                        â”‚                       â”‚â”€â”€7. Update DB1â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                        â”‚                       â”‚   (Cá»™ng tiá»n Account B)â”‚
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚                        â”‚                       â”‚â”€â”€8. Update DB2â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                        â”‚                       â”‚   (Trá»« tiá»n Account A)â”‚
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚                        â”‚                       â”‚â”€â”€9. Update DB2â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                        â”‚                       â”‚   (Cá»™ng tiá»n Account B)â”‚
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚                        â”‚                       â”‚â”€â”€10. COMMITâ”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                        â”‚                       â”‚    (Cáº£ 2 DB)         â”‚
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚                        â”‚<â”€â”€11. Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚<â”€â”€12. Return trueâ”€â”€â”€â”€â”€â”€â”‚                       â”‚                      â”‚
    â”‚                        â”‚                       â”‚                      â”‚
    â”‚â”€â”€13. Show successâ”€â”€    â”‚                       â”‚                      â”‚
    â”‚                        â”‚                       â”‚                      â”‚

â€» Náº¿u cÃ³ lá»—i á»Ÿ bÆ°á»›c 6-9: ROLLBACK cáº£ 2 database
```

## ğŸ›¡ï¸ CÆ¡ cháº¿ Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n (ACID)

### Two-Phase Commit Protocol

```
Phase 1: PREPARE
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Start       â”‚
    â”‚  Transaction â”‚
    â”‚  on DB1 & DB2â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Execute     â”‚
    â”‚  Updates     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Check       â”‚
    â”‚  Success?    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Both Success?â”‚
    â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
       â”‚YES     â”‚NO
       â”‚        â”‚
Phase 2: COMMIT or ROLLBACK
       â”‚        â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚COMMITâ”‚  â”‚ROLLBACK  â”‚
   â”‚ Both â”‚  â”‚  Both    â”‚
   â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Code Implementation

```java
// Báº¯t Ä‘áº§u transaction
conn1.setAutoCommit(false);
conn2.setAutoCommit(false);

try {
    // Phase 1: Execute updates
    boolean db1Success = updateBalance(conn1, from, newBalance1) &&
                        updateBalance(conn1, to, newBalance2);
    
    boolean db2Success = updateBalance(conn2, from, newBalance1) &&
                        updateBalance(conn2, to, newBalance2);
    
    // Phase 2: Commit or Rollback
    if (db1Success && db2Success) {
        conn1.commit();  // âœ“
        conn2.commit();  // âœ“
        return true;
    } else {
        conn1.rollback();  // âœ—
        conn2.rollback();  // âœ—
        return false;
    }
} catch (Exception e) {
    conn1.rollback();
    conn2.rollback();
    throw e;
}
```

## ğŸ“Š Database Schema

```sql
bank_db
â””â”€â”€ accounts
    â”œâ”€â”€ id (INT, PRIMARY KEY, AUTO_INCREMENT)
    â”œâ”€â”€ account_number (VARCHAR(50), UNIQUE, NOT NULL)
    â”œâ”€â”€ account_name (VARCHAR(100), NOT NULL)
    â”œâ”€â”€ balance (DECIMAL(15,2), DEFAULT 0.00)
    â”œâ”€â”€ created_at (TIMESTAMP, DEFAULT CURRENT_TIMESTAMP)
    â””â”€â”€ updated_at (TIMESTAMP, ON UPDATE CURRENT_TIMESTAMP)

Indexes:
- PRIMARY KEY (id)
- UNIQUE INDEX (account_number)
```

## ğŸ”Œ Network Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Firewall Rules   â”‚         â”‚   Firewall Rules   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Port 1099  â”‚â—„â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€>â”‚ Port 1099  â”‚   â”‚
â”‚   â”‚ (RMI)      â”‚   â”‚   LAN   â”‚   â”‚ (RMI)      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Port 3306  â”‚â—„â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€>â”‚ Port 3306  â”‚   â”‚
â”‚   â”‚ (MySQL)    â”‚   â”‚         â”‚   â”‚ (MySQL)    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     Server 1                       Server 2
  (192.168.1.100)                (192.168.1.101)
```

## ğŸ¨ Class Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BankInterface  â”‚
â”‚   <<interface>> â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚+transfer()      â”‚
â”‚+getBalance()    â”‚
â”‚+getAllAccounts()â”‚
â”‚+createAccount() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ implements
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BankServer    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚-dbHandler       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚+transfer()      â”‚
â”‚+getBalance()    â”‚
â”‚+getAllAccounts()â”‚
â”‚+createAccount() â”‚
â”‚+main()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ uses
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DatabaseHandler    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚-getConnection()     â”‚
â”‚-updateBalance()     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚+transfer()          â”‚
â”‚+getBalance()        â”‚
â”‚+getAllAccounts()    â”‚
â”‚+createAccount()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BankClientUI   â”‚          â”‚    Account      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚-bankService     â”‚          â”‚-accountNumber   â”‚
â”‚-components...   â”‚          â”‚-accountName     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚-balance         â”‚
â”‚+connectServer() â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚+performTransfer()â”‚         â”‚+getters()       â”‚
â”‚+loadAccounts()  â”‚          â”‚+setters()       â”‚
â”‚+createAccount() â”‚          â”‚+toString()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Security Considerations

1. **Network Security**
   - Firewall configuration
   - Port restrictions (1099, 3306)
   - VPN for production

2. **Database Security**
   - Strong passwords
   - Limited user privileges
   - SSL connections (recommended)

3. **Application Security**
   - Input validation
   - Transaction isolation
   - Error handling

## âš¡ Performance Optimization

1. **Connection Pooling** (Future enhancement)
   ```java
   // Use HikariCP or C3P0
   HikariConfig config = new HikariConfig();
   config.setJdbcUrl(dbUrl);
   DataSource ds = new HikariDataSource(config);
   ```

2. **Caching** (Future enhancement)
   - Cache account data
   - Reduce database queries

3. **Async Replication** (Alternative approach)
   - Primary database for reads/writes
   - Async replication to secondary
   - Trade-off: Eventual consistency

## ğŸ“ˆ Scalability

```
Current:
  1 RMI Server â†’ 2 MySQL Servers

Future:
  N RMI Servers (Load Balanced)
     â†“
  N MySQL Servers (Replicated)
     â†“
  Sharding by account number
```

---
**TÃ i liá»‡u ká»¹ thuáº­t** | RMI Banking System v1.0
